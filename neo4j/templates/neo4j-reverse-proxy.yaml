
{{- if $.Values.reverseProxy.enabled -}}
apiVersion: v1
kind: Pod
metadata:
  name: {{ include "neo4j.fullname" . }}-reverseproxy
  labels:
    name: {{ include "neo4j.fullname" . }}-reverseproxy
spec:
  containers:
    - name: {{ include "neo4j.fullname" . }}-reverseproxy
      image: {{ $.Values.reverseProxy.image }}
      ports:
        - containerPort: {{ atoi $.Values.reverseProxy.port }}
      env:
        - name: RELEASE_NAME
          value: {{ $.Values.reverseProxy.serviceName }}
        - name: PORT
          value: {{ $.Values.reverseProxy.port | quote }}
        - name: DOMAIN
          value: {{ $.Values.reverseProxy.domain }}
        - name: NAMESPACE
          value: {{ $.Values.reverseProxy.namespace }}
---
apiVersion: v1
kind: Service
metadata:
  name: {{ include "neo4j.fullname" . }}-reverseproxy-service
spec:
  type: ClusterIP
  selector:
    name: {{ include "neo4j.fullname" . }}-reverseproxy
  ports:
    - protocol: TCP
      port: {{ atoi $.Values.reverseProxy.port }}
      targetPort: {{ atoi $.Values.reverseProxy.port }}
---

{{- end -}}

{{- if and $.Values.reverseProxy.enabled $.Values.reverseProxy.ingress.enabled -}}
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{ include "neo4j.fullname" . }}-reverseproxy-ingress
  namespace: default
spec:
  ingressClassName: nginx
  rules:
    - http:
        paths:
          - pathType: Prefix
            backend:
              service:
                name: neo4j-reverseproxy-service
                port:
                  number: {{ atoi $.Values.reverseProxy.port }}
            path: /
---
{{/*---*/}}
{{/*apiVersion: charts.nginx.org/v1alpha1*/}}
{{/*kind: NginxIngress*/}}
{{/*metadata:*/}}
{{/*  name: neo4j-reverseproxy-nginxingress-controller*/}}
{{/*  namespace: nginx-ingress*/}}
{{/*spec:*/}}
{{/*  controller:*/}}
{{/*    image:*/}}
{{/*      pullPolicy: IfNotPresent*/}}
{{/*      repository: nginx/nginx-ingress*/}}
{{/*      tag: 3.2.1-ubi*/}}
{{/*    ingressClass: nginx*/}}
{{/*    kind: deployment*/}}
{{/*    nginxplus: false*/}}
{{/*    replicaCount: 1*/}}
{{- end -}}

